#!/usr/bin/env php
<?php
error_reporting(E_ALL);

use Phalcon\DI;
use Phalcon\Cli\Console;

try
{
    $config = require __DIR__ . '/../config/config.php';

    require_once $config->projectDir . '/config/loader.php';

    $di = new DI\FactoryDefault\Cli();
    $di->get('dispatcher')->setDefaultNamespace('Blog\Console');

    $application = new Console($di);
    $arguments = [];

    foreach ($argv as $k => $arg)
    {
        switch ($k)
        {
            case 0:
                break;

            case 1:
                $arguments['task'] = $arg;
                break;

            /*case 2:
                $arguments['action'] = $arg;
                break;*/

            default:
                $arguments['params'][] = $arg;
        }
    }

    $application->handle($arguments);
}
catch (\Throwable $e)
{
    fwrite(STDERR, $e->getMessage() . PHP_EOL);
}
